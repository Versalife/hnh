---
import BaseLayout from './BaseLayout.astro';
import TableOfContents from '../components/TableOfContents.astro';
import MediumZoom from '../components/MediumZoom.astro';

export interface Props {
  title: string;
  description?: string;
  date: Date;
  discipline: string;
  headings: { depth: number; slug: string; text: string }[];
}

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const { title, description, date, discipline, headings } = Astro.props;

const dateStr = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
const disciplineLabel = discipline.charAt(0).toUpperCase() + discipline.slice(1);
---

<BaseLayout title={title} description={description}>
  <div class="post-page-wrapper">
    <aside class="post-toc-col" aria-label="Table of contents">
      <div class="toc-sticky">
        <TableOfContents headings={headings} />
      </div>
    </aside>

    <div class="post-article-col">
      <article>
        <header class="note-header">
          <nav class="note-breadcrumb" aria-label="Breadcrumb">
            <a href={`${base}/notes`}>Notes</a>
            <span aria-hidden="true"> · </span>
            <span>{disciplineLabel}</span>
          </nav>
          <h1 style="margin-top: 0.5rem;">{title}</h1>
          <p class="note-meta">Last updated {dateStr}</p>
        </header>

        <slot />

        <footer class="note-footer">
          <a href={`${base}/notes`} class="note-back">← All notes</a>
        </footer>
      </article>
    </div>
  </div>

  <MediumZoom />
</BaseLayout>

<style>
  .note-header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-border);
  }

  .note-breadcrumb {
    font-size: 0.82rem;
    color: var(--color-text-muted);
  }

  .note-breadcrumb a {
    color: var(--color-text-muted);
  }

  .note-breadcrumb a:hover {
    color: var(--color-accent);
    text-decoration: none;
  }

  .note-meta {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin: 0;
    font-style: italic;
  }

  .note-footer {
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--color-border);
  }

  .note-back {
    color: var(--color-text-muted);
    font-size: 0.9rem;
  }

  .note-back:hover {
    color: var(--color-accent);
    text-decoration: none;
  }
</style>
