---
import BaseLayout from './BaseLayout.astro';
import TableOfContents from '../components/TableOfContents.astro';
import PrevNext from '../components/PrevNext.astro';
import Citation from '../components/Citation.astro';
import KeyboardNav from '../components/KeyboardNav.astro';
import MediumZoom from '../components/MediumZoom.astro';

export interface Props {
  title: string;
  description?: string;
  date: Date;
  readingTime?: string;
  headings: { depth: number; slug: string; text: string }[];
  prev?: { slug: string; title: string } | null;
  next?: { slug: string; title: string } | null;
  citationKey?: string;
  citationUrl?: string;
}

const { title, description, date, readingTime, headings, prev, next, citationKey, citationUrl } = Astro.props;

const dateStr = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
---

<BaseLayout title={title} description={description}>
  <div class="post-page-wrapper">
    <aside class="post-toc-col" aria-label="Table of contents">
      <div class="toc-sticky">
        <TableOfContents headings={headings} />
      </div>
    </aside>

    <div class="post-article-col">
      <article>
        <header style="margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border);">
          <h1 style="margin-top: 0;">{title}</h1>
          <p style="font-size: 0.875rem; color: var(--color-text-muted); margin: 0;">
            Joseph Okonda · {dateStr}{readingTime ? ` · ${readingTime}` : ''}
          </p>
        </header>

        <slot />

        {citationKey && (
          <Citation
            citationKey={citationKey}
            citationUrl={citationUrl}
            title={title}
            year={date.getFullYear().toString()}
          />
        )}

        <PrevNext prev={prev} next={next} />

        <a href="#top" class="back-to-top">↑ Back to top</a>
      </article>
    </div>
  </div>

  <KeyboardNav />
  <MediumZoom />
</BaseLayout>
