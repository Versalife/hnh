---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import readingTime from 'reading-time';

const base = import.meta.env.BASE_URL.replace(/\/$/, '');

// All posts sorted newest â†’ oldest (drafts included)
const allPosts = (await getCollection('writing'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const postsWithMeta = allPosts.map(post => ({
  post,
  rt: post.data.draft ? null : readingTime(post.body).text,
}));
---

<BaseLayout title="Writing" description="All essays and technical notes.">
  <main style="max-width: var(--content-width); margin: 0 auto; padding: 3rem 1.5rem;">
    <h1 style="font-size: 1.5rem; margin-bottom: 0.25rem;">Writing</h1>
    <p style="color: var(--color-text-muted); font-size: 0.9rem; margin-bottom: 2rem;">
      Essays and technical notes. Titles in grey are works in progress.
    </p>

    <ol class="post-list" reversed start={allPosts.length}>
      {postsWithMeta.map(({ post, rt }) => (
        <li class={`post-list-item${post.data.draft ? ' post-draft' : ''}`}>
          <span class="post-date">
            {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' })}
          </span>
          <span class="post-title">
            {post.data.draft
              ? <span>{post.data.title}</span>
              : <a href={`${base}/writing/${post.slug}`}>{post.data.title}</a>
            }
          </span>
          <span class="post-reading-time">
            {post.data.draft
              ? <span style="font-size: 0.72rem; font-style: italic;">in progress</span>
              : rt
            }
          </span>
        </li>
      ))}
    </ol>
  </main>
</BaseLayout>
